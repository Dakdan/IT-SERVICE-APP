<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IT UDON HOSP - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body, #app { height: 100%; width: 100%; }
    body {
      font-family: 'Kanit', sans-serif;
      background: linear-gradient(180deg, #fce7f3 0%, #fdf2f8 30%, #ffffff 100%);
      position: relative;
      overflow: hidden;
    }
    
    #app {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    body::before {
      content: 'IT UDON HOSP';
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-45deg);
      font-size: 120px;
      font-weight: 700;
      color: rgba(236, 72, 153, 0.03);
      z-index: 0;
      pointer-events: none;
      white-space: nowrap;
    }

    .container-main {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
      overflow: hidden;
    }

    .content-area {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 40;
      animation: fadeIn 0.3s ease;
    }

    .overlay.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal {
      background: white;
      border-radius: 20px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(236, 72, 153, 0.2);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .btn-primary {
      background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Kanit', sans-serif;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(236, 72, 153, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: white;
      color: #ec4899;
      padding: 12px 24px;
      border-radius: 12px;
      border: 2px solid #ec4899;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Kanit', sans-serif;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #fce7f3;
    }

    .btn-secondary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Kanit', sans-serif;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(236, 72, 153, 0.1);
      border: 1px solid rgba(236, 72, 153, 0.1);
    }

    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-waiting { background: #fee2e2; color: #991b1b; }
    .badge-progress { background: #fef3c7; color: #92400e; }
    .badge-done { background: #dcfce7; color: #166534; }
    .badge-high { background: #fee2e2; color: #991b1b; }
    .badge-medium { background: #fef3c7; color: #92400e; }
    .badge-low { background: #dcfce7; color: #166534; }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      display: none;
      z-index: 50;
      animation: slideInUp 0.3s ease;
    }

    .toast.active { display: flex; gap: 12px; align-items: center; }

    @keyframes slideInUp {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .toast-success { border-left: 4px solid #10b981; }
    .toast-error { border-left: 4px solid #ef4444; }
    .toast-warning { border-left: 4px solid #f59e0b; }
    .toast-info { border-left: 4px solid #3b82f6; }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      font-family: 'Kanit', sans-serif;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #ec4899;
      box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .stat-box {
      background: white;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(236, 72, 153, 0.1);
    }

    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: #ec4899;
    }

    .stat-label {
      font-size: 12px;
      color: #6b7280;
      margin-top: 8px;
    }

    .table-responsive {
      width: 100%;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th {
      background: #fce7f3;
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: #374151;
      border-bottom: 2px solid #fbcfe8;
    }

    td {
      padding: 12px;
      border-bottom: 1px solid #f3e8f3;
    }

    tr:hover {
      background: #fdf2f8;
    }

    .hidden { display: none !important; }

    @media (max-width: 768px) {
      .modal {
        padding: 24px;
      }
      table { font-size: 12px; }
      th, td { padding: 8px; }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div id="app" class="container-main"><!-- LOGIN PAGE -->
   <div id="loginPage" class="flex items-center justify-center h-full">
    <div class="card w-full max-w-md mx-4">
     <div class="text-center mb-8"><img src="https://img2.pic.in.th/-227e4f6f84f29f020.png" alt="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•" class="w-16 h-16 mx-auto mb-4 rounded-full border-4 border-pink-200 object-cover">
      <h1 class="text-2xl font-bold text-gray-800 mb-2">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ</h1>
      <p class="text-sm text-pink-600">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô: ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</p>
      <p class="text-xs text-gray-500 mt-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
     </div>
     <div id="loginForm" class="space-y-4">
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label> <input type="text" id="loginUsername" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" class="w-full">
      </div>
      <div><label class="block text-sm font-semibold text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="loginPassword" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full">
      </div><button onclick="handleLogin()" class="btn-primary w-full">üîì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded text-xs text-blue-800">
       <p class="font-semibold mb-1">üìò ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</p>
       <p>üë§ k7 / 212224</p>
       <p>üë§ admin / 1234</p>
      </div>
     </div>
     <div class="mt-6 text-center space-y-3">
      <p class="text-sm text-gray-600">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô?</p><button onclick="showFirstTimeVerify()" class="btn-secondary w-full">üìù ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô</button>
     </div>
    </div>
   </div><!-- MAIN APP -->
   <div id="mainApp" class="hidden flex flex-col h-full"><!-- HEADER -->
    <header class="bg-gradient-to-b from-pink-50 to-white shadow-lg sticky top-0 z-30 border-b-4 border-pink-200">
     <div class="max-w-full px-6 py-4">
      <div class="flex items-center justify-between gap-6">
       <div class="flex items-center gap-5"><img src="https://img2.pic.in.th/-227e4f6f84f29f020.png" alt="‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ" class="w-16 h-16 rounded-full shadow-md border-4 border-pink-200 object-cover">
        <div class="flex flex-col justify-center">
         <h1 class="text-xl font-bold text-gray-800 leading-tight">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ</h1>
         <p class="text-sm font-semibold text-pink-600">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô: ‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</p>
         <p class="text-xs text-gray-600 mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
        </div>
       </div>
       <div class="flex items-center gap-4">
        <div class="flex items-center gap-4 bg-white rounded-2xl px-5 py-3 shadow-md border-2 border-pink-100"><img id="userProfileImg" src="https://img2.pic.in.th/-227e4f6f84f29f020.png" alt="Profile" class="w-12 h-12 rounded-full border-3 border-pink-300 object-cover">
         <div class="text-right flex flex-col justify-center">
          <p id="userName" class="font-bold text-gray-800 text-sm">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
          <p id="userRole" class="text-xs text-pink-600 font-semibold">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</p>
         </div>
        </div><button onclick="handleLogout()" class="btn-danger btn-logout whitespace-nowrap">üö™ ‡∏≠‡∏≠‡∏Å</button>
       </div>
      </div>
     </div>
    </header><!-- TABS -->
    <nav class="bg-white border-b border-pink-100 sticky top-16 z-20">
     <div class="max-w-full px-4 flex gap-2 overflow-x-auto"><button onclick="switchTab(1)" class="tab-btn active px-6 py-3 font-semibold text-sm whitespace-nowrap border-b-4 border-pink-500 text-pink-600" data-tab="1">üìä Dashboard</button> <button onclick="switchTab(2)" class="tab-btn px-6 py-3 font-semibold text-sm whitespace-nowrap border-b-4 border-transparent text-gray-600" data-tab="2">üìã ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button> <button onclick="switchTab(3)" class="tab-btn px-6 py-3 font-semibold text-sm whitespace-nowrap border-b-4 border-transparent text-gray-600" data-tab="3">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button> <button onclick="switchTab(4)" class="tab-btn px-6 py-3 font-semibold text-sm whitespace-nowrap border-b-4 border-transparent text-gray-600" data-tab="4">üîó ‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô</button>
     </div>
    </nav><!-- CONTENT -->
    <div class="content-area p-4"><!-- TAB 1: DASHBOARD -->
     <div id="tab-1" class="tab-content active space-y-6">
      <div>
       <h2 class="text-lg font-bold text-gray-800 mb-4">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h2>
       <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="stat-box">
         <div class="stat-number" id="stat-all">
          0
         </div>
         <div class="stat-label">
          ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
         </div>
        </div>
        <div class="stat-box">
         <div class="stat-number text-red-600" id="stat-waiting">
          0
         </div>
         <div class="stat-label">
          ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
         </div>
        </div>
        <div class="stat-box">
         <div class="stat-number text-yellow-600" id="stat-progress">
          0
         </div>
         <div class="stat-label">
          ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
         </div>
        </div>
        <div class="stat-box">
         <div class="stat-number text-green-600" id="stat-done">
          0
         </div>
         <div class="stat-label">
          ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <h3 class="text-base font-bold text-gray-800 mb-4">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
       <div class="table-responsive">
        <table>
         <thead>
          <tr>
           <th>ID</th>
           <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
           <th>‡∏õ‡∏±‡∏ç‡∏´‡∏≤</th>
           <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
           <th>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</th>
           <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
           <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
         </thead>
         <tbody id="dashboard-jobs">
          <tr>
           <td colspan="7" class="text-center text-gray-500 py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div><!-- TAB 2: MY JOBS -->
     <div id="tab-2" class="tab-content space-y-6">
      <div>
       <h2 class="text-lg font-bold text-gray-800 mb-4">üìã ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô (‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)</h2>
       <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="stat-box">
         <div class="stat-number text-blue-600" id="my-stat-total">
          0
         </div>
         <div class="stat-label">
          ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
         </div>
        </div>
        <div class="stat-box">
         <div class="stat-number text-orange-600" id="my-stat-assigned">
          0
         </div>
         <div class="stat-label">
          ‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢
         </div>
        </div>
        <div class="stat-box">
         <div class="stat-number text-purple-600" id="my-stat-inprogress">
          0
         </div>
         <div class="stat-label">
          ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
         </div>
        </div>
       </div>
      </div>
      <div class="card">
       <h3 class="text-base font-bold text-gray-800 mb-4">üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h3>
       <div class="table-responsive">
        <table>
         <thead>
          <tr>
           <th>ID</th>
           <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
           <th>‡∏õ‡∏±‡∏ç‡∏´‡∏≤</th>
           <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
           <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
           <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
         </thead>
         <tbody id="my-jobs">
          <tr>
           <td colspan="6" class="text-center text-gray-500 py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div><!-- TAB 3: RECORD ACTIVITY -->
     <div id="tab-3" class="tab-content space-y-6">
      <div class="card">
       <h3 class="text-base font-bold text-gray-800 mb-4">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3><button onclick="showAddActivityForm()" class="btn-primary mb-4">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà</button>
       <div class="table-responsive">
        <table>
         <thead>
          <tr>
           <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
           <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
           <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th>
           <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
           <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
         </thead>
         <tbody id="activities-list">
          <tr>
           <td colspan="5" class="text-center text-gray-500 py-8">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td>
          </tr>
         </tbody>
        </table>
       </div>
      </div>
     </div><!-- TAB 4: EXTERNAL LINKS -->
     <div id="tab-4" class="tab-content space-y-6">
      <div class="card">
       <h3 class="text-base font-bold text-gray-800 mb-4">üîó ‡∏£‡∏∞‡∏ö‡∏ö‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</h3>
       <div id="external-links" class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center text-gray-500 py-8">
         ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- OVERLAY & MODALS -->
  <div class="overlay" id="overlay" onclick="closeModal(event)"></div><!-- First Time Verify Modal -->
  <div class="overlay hidden" id="firstTimeOverlay">
   <div class="modal">
    <h2 class="text-xl font-bold text-gray-800 mb-4">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</h2>
    <div class="space-y-4">
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="verifyEmail" placeholder="example@email.com" class="w-full">
     </div>
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label> <input type="text" id="verifyUsername" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" class="w-full">
     </div>
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">üîê ‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</label> <input type="text" id="verifyCode" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô" class="w-full">
     </div>
     <div><label class="block text-sm font-semibold text-gray-700 mb-2">üîë ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label> <input type="password" id="verifyNewPass" placeholder="‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" class="w-full">
     </div>
     <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded text-xs text-green-800 mt-4">
      <p class="font-semibold">üí° ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</p>
      <p>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: staff@udonhosp.go.th</p>
      <p>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: k7</p>
      <p>‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: 2024001</p>
     </div>
     <div class="flex gap-3 pt-4"><button id="verifyBtn" onclick="handleFirstTimeVerify()" class="btn-primary flex-1">‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button> <button onclick="closeFirstTimeModal()" class="btn-secondary flex-1">‚úï ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </div>
   </div>
  </div><!-- Toast -->
  <div id="toast" class="toast"></div><!-- MAIN SCRIPT -->
  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxF7ImGdY6XqcFZ4zp6wSK4KMWTrkBk_NoMS5TucQ-e46EvvzP9O32hSzaENSqgoe0B/exec';
    let currentUser = null;
    let allData = {};
    let currentTab = 1;

    // ============ UTILITIES ============
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.className = `toast active toast-${type}`;
      toast.innerHTML = `
        <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
        <span>${message}</span>
      `;
      setTimeout(() => {
        toast.classList.remove('active');
      }, 3000);
    }

    function closeModal(e) {
      if (e && e.target.id !== 'overlay') return;
      document.getElementById('overlay').classList.remove('active');
    }

    function showFirstTimeVerify() {
      document.getElementById('firstTimeOverlay').classList.remove('hidden');
    }

    function closeFirstTimeModal() {
      document.getElementById('firstTimeOverlay').classList.add('hidden');
      clearVerifyForm();
    }

    function clearVerifyForm() {
      document.getElementById('verifyEmail').value = '';
      document.getElementById('verifyUsername').value = '';
      document.getElementById('verifyCode').value = '';
      document.getElementById('verifyNewPass').value = '';
    }

    // ============ AUTH ============
    async function handleLogin() {
      const user = document.getElementById('loginUsername').value.trim();
      const pass = document.getElementById('loginPassword').value;

      if (!user || !pass) {
        showToast('üö® ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
        return;
      }

      showToast('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...', 'info');
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'checkLogin', data: { user, pass } }),
          headers: { 'Content-Type': 'application/json' }
        });
        
        const result = await response.json();
        
        if (result.success) {
          currentUser = result.user;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          showToast(`‚ú® ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${currentUser.UserName}`, 'success');
          showMainApp();
        } else {
          showToast('‚ùå ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        }
      } catch (err) {
        console.error('Login error:', err);
        showToast('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ', 'error');
      }
    }

    async function handleFirstTimeVerify() {
      const email = document.getElementById('verifyEmail').value.trim();
      const username = document.getElementById('verifyUsername').value.trim();
      const code = document.getElementById('verifyCode').value.trim();
      const newPass = document.getElementById('verifyNewPass').value;

      if (!email || !username || !code || !newPass) {
        showToast('üö® ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'warning');
        return;
      }

      if (newPass.length < 4) {
        showToast('üö® ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£', 'warning');
        return;
      }

      const verifyBtn = document.getElementById('verifyBtn');
      verifyBtn.disabled = true;
      showToast('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...', 'info');
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({ 
            action: 'verifyFirstTime', 
            data: { email, username, code, newPass } 
          }),
          headers: { 'Content-Type': 'application/json' }
        });
        
        const result = await response.json();
        
        if (result.success) {
          showToast('‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ó‡πà‡∏≤‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'success');
          closeFirstTimeModal();
          setTimeout(() => {
            document.getElementById('loginUsername').value = username;
            document.getElementById('loginPassword').value = newPass;
          }, 500);
        } else {
          showToast(`‚ùå ${result.message || '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}`, 'error');
        }
      } catch (err) {
        console.error('Verify error:', err);
        showToast('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ', 'error');
      } finally {
        verifyBtn.disabled = false;
      }
    }

    function handleLogout() {
      const confirmed = confirm('üö™ ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠?');
      if (confirmed) {
        currentUser = null;
        localStorage.removeItem('currentUser');
        document.getElementById('mainApp').classList.add('hidden');
        document.getElementById('loginPage').classList.remove('hidden');
        document.getElementById('loginUsername').value = '';
        document.getElementById('loginPassword').value = '';
        showToast('‚úÖ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
      }
    }

    // ============ UI ============
    function showMainApp() {
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      document.getElementById('userName').textContent = currentUser.UserName;
      document.getElementById('userRole').textContent = currentUser.UserTypeID || '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
      loadAllData();
    }

    async function loadAllData() {
      showToast('‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'getInitialData' }),
          headers: { 'Content-Type': 'application/json' }
        });
        
        const result = await response.json();
        
        if (result.success) {
          allData = result;
          updateDashboard();
          updateMyJobs();
          updateActivities();
          updateExternalLinks();
          showToast('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        } else {
          showToast('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
        }
      } catch (err) {
        console.error('Load data error:', err);
        showToast('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ', 'error');
      }
    }

    function updateDashboard() {
      const jobs = allData.JobTicket || [];
      const waiting = jobs.filter(j => j.Status === '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô').length;
      const progress = jobs.filter(j => j.Status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£').length;
      const done = jobs.filter(j => j.Status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô').length;

      document.getElementById('stat-all').textContent = jobs.length;
      document.getElementById('stat-waiting').textContent = waiting;
      document.getElementById('stat-progress').textContent = progress;
      document.getElementById('stat-done').textContent = done;

      const tbody = document.getElementById('dashboard-jobs');
      if (jobs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô</td></tr>';
      } else {
        tbody.innerHTML = jobs.slice(0, 10).map(job => `
          <tr>
            <td>${job.JobID || '-'}</td>
            <td>${job.JobType || '-'}</td>
            <td>${job.Problem ? job.Problem.substring(0, 30) + (job.Problem.length > 30 ? '...' : '') : '-'}</td>
            <td>${job.Department || '-'}</td>
            <td><span class="badge badge-${getPriority(job.Priority)}">${job.Priority || '-'}</span></td>
            <td><span class="badge badge-${getStatus(job.Status)}">${job.Status || '-'}</span></td>
            <td><button onclick="showJobDetail('${job.JobID}')" class="btn-primary text-xs px-3 py-2">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button></td>
          </tr>
        `).join('');
      }
    }

    function updateMyJobs() {
      const jobs = (allData.JobTicket || []).filter(j => j.Owner === currentUser.UserPN);
      const assigned = jobs.filter(j => j.Status === '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô').length;
      const inprogress = jobs.filter(j => j.Status === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£').length;

      document.getElementById('my-stat-total').textContent = jobs.length;
      document.getElementById('my-stat-assigned').textContent = assigned;
      document.getElementById('my-stat-inprogress').textContent = inprogress;

      const tbody = document.getElementById('my-jobs');
      if (jobs.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</td></tr>';
      } else {
        tbody.innerHTML = jobs.map(job => `
          <tr>
            <td>${job.JobID || '-'}</td>
            <td>${job.JobType || '-'}</td>
            <td>${job.Problem ? job.Problem.substring(0, 30) + (job.Problem.length > 30 ? '...' : '') : '-'}</td>
            <td>${job.Department || '-'}</td>
            <td><span class="badge badge-${getStatus(job.Status)}">${job.Status || '-'}</span></td>
            <td><button onclick="showJobDetail('${job.JobID}')" class="btn-primary text-xs px-3 py-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button></td>
          </tr>
        `).join('');
      }
    }

    function updateActivities() {
      const activities = allData.IT_Ticket || [];
      const tbody = document.getElementById('activities-list');
      
      if (activities.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500 py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</td></tr>';
      } else {
        tbody.innerHTML = activities.slice(0, 5).map(act => `
          <tr>
            <td>${act.Timestamp ? new Date(act.Timestamp).toLocaleDateString('th-TH') : '-'}</td>
            <td>${act.JobType || '-'}</td>
            <td>${act.Department || '-'}</td>
            <td>${(act.Problem || '-').substring(0, 50)}${(act.Problem || '').length > 50 ? '...' : ''}</td>
            <td><button onclick="showActivityDetail('${act.JobID}')" class="btn-primary text-xs px-3 py-2">‡∏î‡∏π</button></td>
          </tr>
        `).join('');
      }
    }

    function updateExternalLinks() {
      const links = (allData.SystemLink || []).filter(l => l.Active === 'Y');
      const container = document.getElementById('external-links');
      
      if (links.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 py-8 col-span-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏∑‡πà‡∏ô</div>';
      } else {
        container.innerHTML = links.map(link => `
          <a href="${link.URL}" target="_blank" rel="noopener noreferrer" 
             class="card text-center hover:shadow-lg transition cursor-pointer p-6">
            <div class="text-4xl mb-2">${link.Linkicon || 'üîó'}</div>
            <p class="font-semibold text-sm text-gray-800">${link.Name || '-'}</p>
          </a>
        `).join('');
      }
    }

    function switchTab(tabNum) {
      currentTab = tabNum;
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('border-pink-500', btn.dataset.tab == tabNum);
        btn.classList.toggle('border-transparent', btn.dataset.tab != tabNum);
        btn.classList.toggle('text-pink-600', btn.dataset.tab == tabNum);
        btn.classList.toggle('text-gray-600', btn.dataset.tab != tabNum);
      });

      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `tab-${tabNum}`);
      });
    }

    function getPriority(p) {
      if (p === '‡∏™‡∏π‡∏á') return 'high';
      if (p === '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á') return 'medium';
      return 'low';
    }

    function getStatus(s) {
      if (s === '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô') return 'waiting';
      if (s === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') return 'progress';
      if (s === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô') return 'done';
      return 'waiting';
    }

    function showJobDetail(jobId) {
      showToast('üîç ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô ' + jobId, 'info');
    }

    function showActivityDetail(actId) {
      showToast('üîç ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ' + actId, 'info');
    }

    function showAddActivityForm() {
      showToast('üìù ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', 'info');
    }

    // ============ INIT ============
    window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('currentUser');
      if (saved) {
        try {
          currentUser = JSON.parse(saved);
          showMainApp();
        } catch (err) {
          console.error('Error parsing saved user:', err);
          localStorage.removeItem('currentUser');
        }
      }
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cb7b06dd3d1a18c',t:'MTc3MDY4NTQzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
